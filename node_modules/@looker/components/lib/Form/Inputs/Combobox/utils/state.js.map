{"version":3,"sources":["../../../../../src/Form/Inputs/Combobox/utils/state.ts"],"names":["ComboboxState","ComboboxActionType","stateChart","initial","IDLE","states","on","BLUR","CLEAR","CHANGE","SUGGESTING","CHANGE_SILENT","CHANGE_VALUES","FOCUS","NAVIGATE","NAVIGATING","SELECT_SILENT","ESCAPE","SELECT_WITH_CLICK","INTERACT","INTERACTING","SELECT_WITH_KEYBOARD","findNavigationValue","state","action","option","persistSelection","singularState","multiState","options","navigationOption","length","undefined","reducer","data","nextState","lastActionType","type","inputValue","Error","getOptionsFromValues","currentOptions","newValues","freeInputValues","newOptions","filter","text","foundInOptions","includes","index","indexOf","splice","freeInputOptions","map","value","reducerMulti","inputValues","o1","o2","useReducerMachine","initialData","setState","dispatch","transition","payload","currentState","console","warn","useReducerMultiMachine"],"mappings":"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","sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2020 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\n// Much of the following is pulled from https://github.com/reach/reach-ui\n// because their work is fantastic (but is not in TypeScript)\n\nimport xorWith from 'lodash/xorWith'\nimport { Reducer, useReducer, useState } from 'react'\nimport { ComboboxOptionObject } from '../ComboboxOption'\nimport { getComboboxText } from './getComboboxText'\n\nexport enum ComboboxState {\n  // Nothing going on, waiting for the user to type or use the arrow keys\n  IDLE = 'IDLE',\n\n  // The component is suggesting options as the user types\n  SUGGESTING = 'SUGGESTING',\n\n  // The user is using the keyboard to navigate the list, not typing\n  NAVIGATING = 'NAVIGATING',\n\n  // The user is interacting with arbitrary elements inside the popup that\n  // are not ComboboxInputs\n  INTERACTING = 'INTERACTING',\n}\n\nexport enum ComboboxActionType {\n  // User cleared the value w/ backspace, but input still has focus\n  CLEAR = 'CLEAR',\n\n  // User is typing\n  CHANGE = 'CHANGE',\n\n  // Used for the setting the initial value\n  CHANGE_SILENT = 'CHANGE_SILENT',\n\n  // Used for ComboboxMultiInput when the ComboboxMultiInput has chips removed\n  CHANGE_VALUES = 'CHANGE_VALUES',\n\n  // User is navigating w/ the keyboard\n  NAVIGATE = 'NAVIGATE',\n\n  // User can be navigating with keyboard and then click instead, we want the\n  // value from the click, not the current nav item\n  SELECT_WITH_KEYBOARD = 'SELECT_WITH_KEYBOARD',\n  SELECT_WITH_CLICK = 'SELECT_WITH_CLICK',\n\n  // Used for the setting the initial option\n  SELECT_SILENT = 'SELECT_SILENT',\n\n  // Pretty self-explanatory, user can hit escape or blur to close the popover\n  ESCAPE = 'ESCAPE',\n  BLUR = 'BLUR',\n\n  // The user left the input to interact with arbitrary elements inside the popup\n  INTERACT = 'INTERACT',\n\n  FOCUS = 'FOCUS',\n}\n\nexport interface ComboboxData {\n  inputValue?: string\n  option?: ComboboxOptionObject\n  navigationOption?: ComboboxOptionObject\n  lastActionType?: ComboboxActionType\n}\n\nexport interface ComboboxMultiData extends Omit<ComboboxData, 'option'> {\n  /**\n   * Multi uses both inputValue (typed) and inputValues  (entered chips)\n   */\n  options: ComboboxOptionObject[]\n}\n\nexport interface ComboboxAction {\n  type: ComboboxActionType\n  state: ComboboxState\n}\n\nexport interface ComboboxActionPayload {\n  option?: ComboboxOptionObject\n  persistSelection?: boolean\n  inputValue?: string\n}\n\nexport interface ComboboxMultiActionPayload extends ComboboxActionPayload {\n  // for when user removes chips directly\n  inputValues?: string[]\n  // only for SELECT_SILENT\n  options?: ComboboxOptionObject[]\n}\n\nexport type ComboboxActionWithPayload = ComboboxAction & ComboboxActionPayload\nexport type ComboboxMultiActionWithPayload = ComboboxAction &\n  ComboboxMultiActionPayload\n\nexport interface StateChart {\n  initial: ComboboxState\n  states: {\n    [key in ComboboxState]: {\n      on: { [key in ComboboxActionType]?: ComboboxState }\n    }\n  }\n}\n\nexport type ComboboxTransition<TPayload = ComboboxActionPayload> = (\n  action: ComboboxActionType,\n  payload?: TPayload\n) => void\n\nexport const stateChart: StateChart = {\n  initial: ComboboxState.IDLE,\n  states: {\n    [ComboboxState.IDLE]: {\n      on: {\n        [ComboboxActionType.BLUR]: ComboboxState.IDLE,\n        [ComboboxActionType.CLEAR]: ComboboxState.IDLE,\n        [ComboboxActionType.CHANGE]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CHANGE_SILENT]: ComboboxState.IDLE,\n        [ComboboxActionType.CHANGE_VALUES]: ComboboxState.IDLE,\n        [ComboboxActionType.FOCUS]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.NAVIGATE]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.SELECT_SILENT]: ComboboxState.IDLE,\n      },\n    },\n    [ComboboxState.SUGGESTING]: {\n      on: {\n        [ComboboxActionType.CHANGE]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CHANGE_SILENT]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CHANGE_VALUES]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.FOCUS]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.NAVIGATE]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.CLEAR]: ComboboxState.IDLE,\n        [ComboboxActionType.ESCAPE]: ComboboxState.IDLE,\n        [ComboboxActionType.BLUR]: ComboboxState.IDLE,\n        [ComboboxActionType.SELECT_WITH_CLICK]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.SELECT_SILENT]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.INTERACT]: ComboboxState.INTERACTING,\n      },\n    },\n    [ComboboxState.NAVIGATING]: {\n      on: {\n        [ComboboxActionType.CHANGE]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CHANGE_SILENT]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.CHANGE_VALUES]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.FOCUS]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CLEAR]: ComboboxState.IDLE,\n        [ComboboxActionType.BLUR]: ComboboxState.IDLE,\n        [ComboboxActionType.ESCAPE]: ComboboxState.IDLE,\n        [ComboboxActionType.NAVIGATE]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.SELECT_WITH_CLICK]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.SELECT_WITH_KEYBOARD]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.SELECT_SILENT]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.INTERACT]: ComboboxState.INTERACTING,\n      },\n    },\n    [ComboboxState.INTERACTING]: {\n      on: {\n        [ComboboxActionType.CHANGE]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CHANGE_SILENT]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.CHANGE_VALUES]: ComboboxState.INTERACTING,\n        [ComboboxActionType.FOCUS]: ComboboxState.SUGGESTING,\n        [ComboboxActionType.BLUR]: ComboboxState.IDLE,\n        [ComboboxActionType.ESCAPE]: ComboboxState.IDLE,\n        [ComboboxActionType.NAVIGATE]: ComboboxState.NAVIGATING,\n        [ComboboxActionType.SELECT_WITH_CLICK]: ComboboxState.INTERACTING,\n        [ComboboxActionType.SELECT_SILENT]: ComboboxState.INTERACTING,\n      },\n    },\n  },\n}\n\n// When we open a list, set the navigation option to the option in the input, if\n// it's in the list, then it'll automatically be highlighted.\nconst findNavigationValue = (\n  state: ComboboxData | ComboboxMultiData,\n  action: ComboboxActionPayload\n) => {\n  if (action.option) {\n    return action.option\n  } else if (action.persistSelection) {\n    const singularState = state as ComboboxData\n    const multiState = state as ComboboxMultiData\n    return singularState.option\n      ? singularState.option\n      : multiState.options\n      ? multiState.navigationOption ||\n        multiState.options[multiState.options.length - 1]\n      : undefined\n  } else {\n    return undefined\n  }\n}\n\nconst reducer: Reducer<ComboboxData, ComboboxActionWithPayload> = (\n  data,\n  action\n) => {\n  const nextState = { ...data, lastActionType: action.type }\n  switch (action.type) {\n    case ComboboxActionType.CHANGE:\n    case ComboboxActionType.CHANGE_SILENT:\n      return {\n        ...nextState,\n        inputValue: action.inputValue,\n      }\n    case ComboboxActionType.NAVIGATE:\n      return {\n        ...nextState,\n        navigationOption: findNavigationValue(nextState, action),\n      }\n    case ComboboxActionType.CLEAR:\n      return {\n        ...nextState,\n        inputValue: '',\n        navigationOption: undefined,\n        option: undefined,\n      }\n    case ComboboxActionType.BLUR:\n    case ComboboxActionType.ESCAPE:\n      return {\n        ...nextState,\n        inputValue: getComboboxText(data.option),\n        navigationOption: undefined,\n      }\n    case ComboboxActionType.SELECT_WITH_CLICK:\n    case ComboboxActionType.SELECT_SILENT:\n      return {\n        ...nextState,\n        inputValue: getComboboxText(action.option),\n        navigationOption: undefined,\n        option: action.option,\n      }\n    case ComboboxActionType.SELECT_WITH_KEYBOARD:\n      return {\n        ...nextState,\n        inputValue: getComboboxText(data.navigationOption),\n        navigationOption: undefined,\n        option: data.navigationOption,\n      }\n    case ComboboxActionType.INTERACT:\n      return nextState\n    case ComboboxActionType.FOCUS:\n      return {\n        ...nextState,\n        navigationOption: findNavigationValue(nextState, action),\n      }\n\n    default:\n      throw new Error(`Unknown action ${action.type}`)\n  }\n}\n\n// Update options from as input values are added / removed via InputChips(Base)\nexport function getOptionsFromValues(\n  currentOptions: ComboboxOptionObject[],\n  newValues?: string[]\n) {\n  if (!newValues) return []\n  // Save any values not found in current options\n  const freeInputValues = [...newValues]\n\n  const newOptions = currentOptions.filter((option) => {\n    const text = getComboboxText(option)\n    const foundInOptions = newValues.includes(text)\n    if (foundInOptions) {\n      const index = freeInputValues.indexOf(text)\n      if (index > -1) {\n        freeInputValues.splice(index, 1)\n      }\n    }\n    return foundInOptions\n  })\n  // Convert new values into options\n  // ****NOTE****\n  // freeInput options may be near-duplicates of existing options (different case, value / label mismatch, etc)\n  // this option should be used only when exact matching to existing values is not important or can be handled externally\n  const freeInputOptions = freeInputValues.map((value) => ({ value }))\n\n  return [...newOptions, ...freeInputOptions]\n}\n\nconst reducerMulti: Reducer<\n  ComboboxMultiData,\n  ComboboxMultiActionWithPayload\n> = (data, action) => {\n  const nextState = { ...data, lastActionType: action.type }\n  switch (action.type) {\n    case ComboboxActionType.CHANGE:\n    case ComboboxActionType.CHANGE_SILENT:\n      return {\n        ...nextState,\n        inputValue: action.inputValue,\n      }\n    case ComboboxActionType.CHANGE_VALUES:\n      return {\n        ...nextState,\n        navigationOption: undefined,\n        options: getOptionsFromValues(nextState.options, action.inputValues),\n      }\n    case ComboboxActionType.NAVIGATE:\n      return {\n        ...nextState,\n        navigationOption: findNavigationValue(nextState, action),\n      }\n    case ComboboxActionType.CLEAR:\n      return {\n        ...nextState,\n        inputValue: '',\n        navigationOption: undefined,\n        options: [],\n      }\n    case ComboboxActionType.BLUR:\n    case ComboboxActionType.ESCAPE:\n      return {\n        ...nextState,\n        inputValue: '',\n        navigationOption: undefined,\n      }\n    case ComboboxActionType.SELECT_WITH_CLICK:\n      return {\n        ...nextState,\n        inputValue: '',\n        navigationOption: findNavigationValue(nextState, action),\n        options: xorWith(\n          nextState.options,\n          action.option ? [action.option] : [],\n          (o1, o2) => o1.value === o2.value\n        ),\n      }\n    case ComboboxActionType.SELECT_SILENT:\n      return {\n        ...nextState,\n        inputValue: '',\n        navigationOption: undefined,\n        options: action.options || [],\n      }\n    case ComboboxActionType.SELECT_WITH_KEYBOARD:\n      return {\n        ...nextState,\n        inputValue: '',\n        navigationOption: findNavigationValue(nextState, action),\n        options: xorWith(\n          nextState.options,\n          data.navigationOption ? [data.navigationOption] : [],\n          (o1, o2) => o1.value === o2.value\n        ),\n      }\n    case ComboboxActionType.INTERACT:\n      return nextState\n    case ComboboxActionType.FOCUS:\n      return {\n        ...nextState,\n        navigationOption: findNavigationValue(nextState, action),\n      }\n\n    default:\n      throw new Error(`Unknown action ${action.type}`)\n  }\n}\n\n// This manages transitions between states with a built in reducer to manage\n// the data that goes with those transitions.\nexport function useReducerMachine(\n  initialData: ComboboxData\n): [ComboboxState, ComboboxData, ComboboxTransition] {\n  const [state, setState] = useState(stateChart.initial)\n  const [data, dispatch] = useReducer(reducer, initialData)\n\n  function transition(\n    action: ComboboxActionType,\n    payload: ComboboxActionPayload = {}\n  ) {\n    const currentState = stateChart.states[state]\n    const nextState = currentState.on[action]\n    if (!nextState) {\n      // eslint-disable-next-line no-console\n      console.warn(`Unknown action \"${action}\" for state \"${state}\"`)\n      return\n    }\n    dispatch({ state, type: action, ...payload })\n    setState(nextState)\n  }\n\n  return [state, data, transition]\n}\nexport function useReducerMultiMachine(\n  initialData: ComboboxMultiData\n): [\n  ComboboxState,\n  ComboboxMultiData,\n  ComboboxTransition<ComboboxMultiActionPayload>\n] {\n  const [state, setState] = useState(stateChart.initial)\n  const [data, dispatch] = useReducer(reducerMulti, initialData)\n\n  function transition(\n    action: ComboboxActionType,\n    payload: ComboboxMultiActionPayload = { inputValues: [], options: [] }\n  ) {\n    const currentState = stateChart.states[state]\n    const nextState = currentState.on[action]\n    if (!nextState) {\n      // eslint-disable-next-line no-console\n      console.warn(`Unknown action \"${action}\" for state \"${state}\"`)\n      return\n    }\n    dispatch({ state, type: action, ...payload })\n    setState(nextState)\n  }\n\n  return [state, data, transition]\n}\n"],"file":"state.js"}